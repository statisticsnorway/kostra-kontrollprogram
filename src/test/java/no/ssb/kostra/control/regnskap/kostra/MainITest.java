package no.ssb.kostra.control.regnskap.kostra;

import no.ssb.kostra.felles.Constants;
import no.ssb.kostra.felles.ErrorReport;
import no.ssb.kostra.controlprogram.Arguments;
import org.junit.After;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

@Ignore
public class MainITest {
    InputStream sysInBackup;
    private Arguments args;


    @Before
    public void beforeTest() {
        //@formatter:off
        //00000000111111111122222222223333333333444444444
        //23456789012345678901234567890123456789012345678
        String inputFileContent = "0C2020 340000                  1860 990  .......\n" +
                "0C2020 340000                  1860 Z          0\n" +
                "0C2020 340000                  Z860 990        0\n" +
                "0C2020 340000                  1860 990  -503152\n" +
                "0C2020 340000                  1841 990        0\n" +
                "0C2020 340000                  1790 950     -195\n" +
                "0C2020 340000                  1771 950    -9852\n" +
                "0C2020 340000                  1716 950    -3572\n" +
                "0C2020 340000                  1590 950    -1866\n" +
                "0C2020 340000                  1561 950      -77\n" +
                "0C2020 340000                  1559 950     -427\n" +
                "0C2020 340000                  1554 950  -241666\n" +
                "0C2020 340000                  1480 950    -2083\n" +
                "0C2020 340000                  1660 940    -1383\n" +
                "0C2020 340000                  1472 940   -46654\n" +
                "0C2020 340000                  1465 940        0\n" +
                "0C2020 340000                  1880 930   -31768\n" +
                "0C2020 340000                  1850 920        0\n" +
                "0C2020 340000                  1715 890     -116\n" +
                "0C2020 340000                  1526 890      -67\n" +
                "0C2020 340000                  1521 890      -16\n" +
                "0C2020 340000                  1515 890      -42\n" +
                "0C2020 340000                  1800 870  -132142\n" +
                "0C2020 340000                  1730 810  -100000\n" +
                "0C2020 340000                  1701 810   -31355\n" +
                "0C2020 340000                  1570 810    -2611\n" +
                "0C2020 340000                  1515 810     -250\n" +
                "0C2020 340000                  1840 800  -396529\n" +
                "0C2020 340000                  1775 710      -12\n" +
                "0C2020 340000                  1750 710     -803\n" +
                "0C2020 340000                  1722 710     -180\n" +
                "0C2020 340000                  1590 710    -5826\n" +
                "0C2020 340000                  1562 710    -9247\n" +
                "0C2020 340000                  1524 710    -2038\n" +
                "0C2020 340000                  1520 710    -4079\n" +
                "0C2020 340000                  1510 710    -5548\n" +
                "0C2020 340000                  1772 700  -225444\n" +
                "0C2020 340000                  1740 700     -225\n" +
                "0C2020 340000                  1532 700      -25\n" +
                "0C2020 340000                  1522 700     -131\n" +
                "0C2020 340000                  1480 700    -2820\n" +
                "0C2020 340000                  1420 700    -1176\n" +
                "0C2020 340000                  1665 600  -100260\n" +
                "0C2020 340000                  1722 590   256708\n" +
                "0C2020 340000                  1430 590    21000\n" +
                "0C2020 340000                  1510 590   225444\n" +
                "0C2020 340000                  1771 550    11643\n" +
                "0C2020 340000                  1732 550     2668\n" +
                "0C2020 340000                  1715 550     3357\n" +
                "0C2020 340000                  1701 550    22503\n" +
                "0C2020 340000                  1523 550      324\n" +
                "0C2020 340000                  1880 540    50003\n" +
                "0C2020 340000                  1870 509     1163\n" +
                "0C2020 340000                  1711 509       16\n" +
                "0C2020 340000                  1531 500        1\n" +
                "0C2020 340000                  1734 470      605\n" +
                "0C2020 340000                  1716 470    13505\n" +
                "0C2020 340000                  1665 470     1248\n" +
                "0C2020 340000                  1554 470    17626\n" +
                "0C2020 340000                  1400 470    11647\n" +
                "0C2020 340000                  1840 429     -424\n" +
                "0C2020 340000                  1731 429     1029\n" +
                "0C2020 340000                  1526 429      392\n" +
                "0C2020 340000                  1460 429       28\n" +
                "0C2020 340000                  1421 429     1055\n" +
                "0C2020 340000                  1480 400      325\n" +
                "0C2020 340000                  1410 375     2631\n" +
                "0C2020 340000                  1732 370   166053\n" +
                "0C2020 340000                  1730 370   672102\n" +
                "0C2020 340000                  1590 350     3717\n" +
                "0C2020 340000                  1722 270       47\n" +
                "0C2020 340000                  1581 270      829\n" +
                "0C2020 340000                  1532 270     1025\n" +
                "0C2020 340000                  1527 270      444\n" +
                "0C2020 340000                  1522 270       46\n" +
                "0C2020 340000                  1430 270      162\n" +
                "0C2020 340000                  1561 260      110\n" +
                "0C2020 340000                  1554 260        8\n" +
                "0C2020 340000                  1529 250       17\n" +
                "0C2020 340000                  1521 250        2\n" +
                "0C2020 340000                  1590 230      309\n" +
                "0C2020 340000                  1530 230       10\n" +
                "0C2020 340000                  1528 230       50\n" +
                "0C2020 340000                  1740 200      956\n" +
                "0C2020 340000                  1531 200      574\n" +
                "0C2020 340000                  1525 200      114\n" +
                "0C2020 340000                  1520 200     1281\n" +
                "0C2020 340000                  1760 180      328\n" +
                "0C2020 340000                  1570 180       34\n" +
                "0C2020 340000                  1559 180       17\n" +
                "0C2020 340000                  1771 105       12\n" +
                "0C2020 340000                  1523 105     2966\n" +
                "0C2020 340000                  1515 105     3579\n" +
                "0C2020 340000                  1775 099      207\n" +
                "0C2020 340000                  1750 099     3136\n" +
                "0C2020 340000                  1733 099        8\n" +
                "0C2020 340000                  1660 099     1489\n" +
                "0C2020 340000                  1533 099     1893\n" +
                "0C2020 340000                  1480 Z      -4720\n" +
                "0C2020 340000                  1400 099     2514\n" +
                "0C2020 340000                  1790 090      825\n" +
                "0C2020 340000                  1524 090     2777\n" +
                "0C2020 340000                  1473 090   -10001\n" +
                "0C2020 340000                  1472 090   -10249\n" +
                "0C2020 340000                  1471 090    58388\n" +
                "0C2020 340000                  1420 090    12133\n" +
                "0C2020 340000                  1562 075      200\n" +
                "0C2020 340000                  1510 075    64228\n" +
                "0C2020 340000                  1880 570   241520\n" +
                "0C2020 340000                  0430 670     -200\n" +
                "0C2020 340000                  0510 940   -17861\n" +
                "0C2020 340000                  0510 900   -13299\n" +
                "0C2020 340000                  0590 950      -35\n" +
                "0C2020 340000                  0701 520   108687\n" +
                "0C2020 340000                  0701 500     2081\n" +
                "0C2020 340000                  0870 520   143000\n" +
                "0C2020 340000                  0870 529    19147\n" +
                "0C2020 340000                  0880 970  -241520\n";
        //@formatter:on


        sysInBackup = System.in; // backup System.in to restore it later
        ByteArrayInputStream in = new ByteArrayInputStream(inputFileContent.getBytes(StandardCharsets.ISO_8859_1));
        System.setIn(in);

        args = new Arguments(new String[]{"-s", "0C", "-y", "2020", "-r", "340000"});
    }

    @After
    public void afterTest() {
        System.setIn(sysInBackup);
    }

    @Test
    public void testDoControl() {
        ErrorReport er = Main.doControls(args);

        if (Constants.DEBUG) {
            System.out.print(er.generateReport());
        }

        assertNotNull("Has content ErrorReport", er);
        assertEquals(Constants.CRITICAL_ERROR, er.getErrorType());
    }

}
