package no.ssb.kostra.control.sosial.s11_sosialhjelp;

import no.ssb.kostra.felles.Constants;
import no.ssb.kostra.felles.ErrorReport;
import no.ssb.kostra.felles.FieldDefinition;
import no.ssb.kostra.controlprogram.Arguments;
import org.junit.After;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;
import java.util.List;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;

@Ignore
public class MainOkITest {
    InputStream sysInBackup;
    private Arguments args;
    private ErrorReport er;
    private String inputFileContent;
    private List<FieldDefinition> fieldDefinitions;


    @Before
    public void beforeTest() {
        //@formatter:off
        inputFileContent =
                //00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111122222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222223333333333333333333333333
                //00000000111111111122222222223333333333444444444455555555556666666666777777777788888888889999999999000000000011111111112222222222333333333344444444445555555555666666666677777777778888888888999999999900000000001111111111222222222233333333334444444444555555555566666666667777777777888888888899999999990000000000111111111122222
                //23456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234
                "42042004040000186201010150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186213100499500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186211069550500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186221012250500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186201010150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186211020150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186221030150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186201040150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186211050150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186221060150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102222                                                    \n" +
                "42042004040000186201070150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102222                                                    \n" +
                "42042004040000186211080150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186221090150500            13102512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102422                                                    \n" +
                "42042004040000186201010150500            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102622                                                    \n" +
                "42042004040000186211010150500            13101112020102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102322                                                    \n" +
                "42042004040000186221010150500            13101212050102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102322                                                    \n" +
                "42042004040000186201010150500            13101412030102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102322                                                    \n" +
                "42042004040000186211010150500            13101612090102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186221010150500            13101812100102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186219096631556            132  302040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102122                                                    \n" +
                "42042004040000186219096631556            132  304040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102222                                                    \n" +
                "42042004040000186219096631556            13103305050102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102322                                                    \n" +
                "42042004040000186219096631556            13101304040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102422                                                    \n" +
                "42042004040000186219096631556            13101311040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102422                                                    \n" +
                "42042004040000186219096631556            13101311050102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102422                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102622                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102722                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102622                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102722                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120473964       0473964                                                                                                                                                                 11per0001020122                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0000102222                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 12per0000102622                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 12per0001020122                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0001020622                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011120073964       0073964                                                                                                                                                                 11per0001020722                                                    \n" +
                "42042004040000186219096631556            13101512040000000000000000000000000073964000560000739640005600                                                                                                                                                          11per0001020122                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091011000073964       0073964                                                                                                                                                                 11per0000102322                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708091000000073964       0073964                                                                                                                                                                 11per0000102222                                                    \n" +
                "42042004040000186219096631556            13101512040102030405060708000000000073964       0073964                                                                                                                                                                 11per000010231201051831121916                  19                  \n" +
                "42042004040000186219096631556            13101512040102030400000000000000000073964       0073964                                                                                                                                                                 11per000010231201051831121916        08                            \n" +
                "42042004040000186219096631556            13101512040102000000000000000000000073964       0073964                                                                                                                                                                 11per0000102312010219311219    04                                  \n" +
                "42042004040000186219096631556            13101512040100000000000000000000000073964       0073964                                                                                                                                                                 11per0000102312010218311219    04                                  \n";

        //@formatter:on

        sysInBackup = System.in; // backup System.in to restore it later
        ByteArrayInputStream in = new ByteArrayInputStream(inputFileContent.getBytes(StandardCharsets.ISO_8859_1));
        System.setIn(in);

        fieldDefinitions = FieldDefinitions.getFieldDefinitions();

        args = new Arguments(new String[]{"-s", "11F", "-y", "2020", "-r", "420400"});
    }

    @After
    public void afterTest() {
        System.setIn(sysInBackup);
    }

    @Test
    public void testDoControl() {
        er = Main.doControls(args);

        if (Constants.DEBUG) {
            System.out.print(er.generateReport());
        }

        assertNotNull("Has content ErrorReport", er);
        assertEquals(Constants.CRITICAL_ERROR, er.getErrorType());
    }


}
